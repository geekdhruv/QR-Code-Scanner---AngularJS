<div class="scanner-wrapper">
  <!-- Permission Request -->
  <div *ngIf="permissionError" class="permission-request mb-6">
    <i class="fas fa-camera"></i>
    <h3 class="text-lg font-semibold mb-2">Camera Permission Required</h3>
    <p class="mb-4">This app needs access to your camera to scan QR codes.</p>
    <button class="btn btn-primary" (click)="requestPermission()">
      <i class="fas fa-key"></i> Grant Permission
    </button>
  </div>

  <!-- No Devices Available -->
  <div *ngIf="!hasDevices && hasPermission" class="text-center p-8">
    <div class="spinner mb-4"></div>
    <p class="text-gray-600">Looking for available cameras...</p>
  </div>

  <!-- Camera Selection -->
  <div *ngIf="hasDevices && availableDevices.length > 1" class="mb-4">
    <label for="camera-select-fallback" class="block text-sm font-medium text-gray-700 mb-2">
      Select Camera:
    </label>
    <select 
      id="camera-select-fallback"
      class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      (change)="onDeviceSelectChange($event)">
      <option 
        *ngFor="let device of availableDevices" 
        [value]="device.deviceId"
        [selected]="selectedDevice?.deviceId === device.deviceId">
        {{ device.label || 'Camera ' + (availableDevices.indexOf(device) + 1) }}
      </option>
    </select>
  </div>

  <!-- Scanner Component -->
  <div *ngIf="hasDevices && hasPermission" class="scanner-container">
    <video #video autoplay playsinline muted class="scanner-video"></video>
    <canvas #canvas style="display: none;"></canvas>
    
    <!-- Scanner Overlay -->
    <div class="scanner-overlay">
      <div class="scanner-frame">
        <div class="scanning-indicator">
          <div class="scan-line"></div>
        </div>
      </div>
    </div>

    <!-- Start/Stop Button -->
    <div class="scanner-controls">
      <button 
        *ngIf="!isScanning" 
        class="btn btn-primary" 
        (click)="startScanning()">
        <i class="fas fa-play"></i> Start Scanning
      </button>
      <button 
        *ngIf="isScanning" 
        class="btn btn-danger" 
        (click)="stopScanning()">
        <i class="fas fa-stop"></i> Stop Scanning
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="!hasDevices && !permissionError" class="text-center p-8">
    <div class="spinner mb-4"></div>
    <p class="text-gray-600">Initializing scanner...</p>
  </div>

  <!-- Demo Mode Notice -->
  <div *ngIf="hasDevices && hasPermission" class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
    <div class="flex items-center">
      <i class="fas fa-info-circle text-yellow-600 mr-2"></i>
      <span class="text-sm text-yellow-800">
        <strong>Demo Mode:</strong> This is a demonstration version. Click "Start Scanning" to simulate QR code detection.
      </span>
    </div>
  </div>
</div>
